# Task: INT-005

## Metadata
- **Lane**: INTEGRATION
- **Type**: ADD_PURE_FN
- **Severity**: CRITICAL
- **Status**: PENDING
- **Created**: 2026-01-15T00:00:00Z

## Context Pack

### Current Command Structure (swarm.py lines 66-78)
```python
def main():
    if len(sys.argv) < 2:
        print("Usage: swarm.py [status|wave|tasks|results|collect]")
        sys.exit(1)
    cmd = sys.argv[1].lower()
    commands = {'status': cmd_status, 'wave': cmd_new_wave, 'tasks': cmd_list_tasks, 'results': cmd_list_results, 'collect': cmd_collect}
    if cmd not in commands:
        print(f"Unknown command: {cmd}")
        print("Available: status, wave, tasks, results, collect")
        sys.exit(1)
    commands[cmd]()
```

### Existing cmd_ Function Pattern
```python
def cmd_status():
    state = load_state()
    print(f"=== SWARM STATUS ===\")
    print(f"Wave: {state['wave']}")
    print(f"Active Zerglings: {len(state.get('active_zerglings', []))}\")")
    print(f"Pending Tasks: {len(state.get('pending_tasks', []))}\")")
    print(f"Completed Tasks: {len(state.get('completed_tasks', []))}\")")
```

### State File Structure (swarm.py lines 8-10)
```python
SWARM_ROOT = Path(__file__).parent.parent
STATE_FILE = SWARM_ROOT / "STATE.json"
OUTBOX_DIR = SWARM_ROOT / "OUTBOX"
INBOX_DIR = SWARM_ROOT / "INBOX"
```

### Files to modify (ONLY these)
- /home/ubuntu/projects/zerg-swarm/SWARM/SCRIPTS/swarm.py

## Objective
Implement three missing CLI commands documented in RUNBOOK.md: `kill <task_id>`, `reset`, and add `--verbose` flag to `status`.

## Deliverables
- [ ] Implement `cmd_kill(task_id)` function to remove task from pending state
- [ ] Implement `cmd_reset()` function to clear wave counter and task lists
- [ ] Add `--verbose` flag parsing to `cmd_status()` for detailed output
- [ ] Update `main()` to handle positional arguments (kill <task_id>)
- [ ] Update usage string to include new commands
- [ ] Verify all commands with check command (see below)

## Technical Requirements

### 1. cmd_kill(task_id) Implementation
Purpose: Remove a task from pending_tasks list and mark it as killed
- Takes task_id as argument from sys.argv[2]
- Removes task_id from state['pending_tasks'] if present
- Updates state['completed_tasks'] with killed status (optional)
- Saves updated state
- Print confirmation: "Task <task_id> killed"
- Error handling: task not found warning (non-fatal)

### 2. cmd_reset() Implementation
Purpose: Reset swarm to clean state (as documented in RUNBOOK.md emergency commands)
- Set wave back to 0
- Clear active_zerglings list
- Clear pending_tasks list
- Clear completed_tasks list
- Set last_updated timestamp
- Save state
- Print confirmation: "Swarm state reset to clean state"

### 3. cmd_status() --verbose Flag Enhancement
Purpose: Show detailed task information when --verbose is used
- Detect if sys.argv has '--verbose' flag
- If verbose: show active_zerglings list items
- If verbose: show pending_tasks list items (first 5 with ellipsis if more)
- If verbose: show completed_tasks count detail
- Maintain existing compact output when flag absent

### Example Verbose Output
```
=== SWARM STATUS ===
Wave: 2
Active Zerglings: 3
  - ZERGLING-1 (Wave 2)
  - ZERGLING-2 (Wave 2)
  - ZERGLING-3 (Wave 2)
Pending Tasks: 5
  - TASK-001
  - TASK-002
  - TASK-003
  - ... (2 more)
Completed Tasks: 12
Last Updated: 2026-01-15T10:30:45.123456
```

### Updated main() Logic
```python
def main():
    if len(sys.argv) < 2:
        print("Usage: swarm.py [status|wave|tasks|results|collect|kill|reset]")
        print("  status [--verbose]  - Show swarm status")
        print("  kill <task_id>      - Kill a task")
        print("  reset               - Reset swarm state")
        sys.exit(1)
    cmd = sys.argv[1].lower()
    # Handle commands with arguments
    if cmd == 'kill':
        if len(sys.argv) < 3:
            print("Usage: swarm.py kill <task_id>")
            sys.exit(1)
        cmd_kill(sys.argv[2])
    else:
        commands = {...}  # Existing mapping
        if cmd not in commands:
            print(f"Unknown command: {cmd}")
            sys.exit(1)
        commands[cmd]()
```

## Verification Command
```bash
# Test kill command
cd /home/ubuntu/projects/zerg-swarm/SWARM/SCRIPTS
python3 swarm.py kill TEST-001
echo "✓ kill command works"

# Test reset command
python3 swarm.py reset
python3 swarm.py status
echo "✓ reset command works"

# Test verbose flag
python3 swarm.py status --verbose
echo "✓ verbose flag works"

# Test help still works
python3 swarm.py --help 2>/dev/null || python3 swarm.py
echo "✓ help text updated"
```

## Constraints
- Max 80 lines of new code
- No new dependencies (use stdlib only)
- Must maintain backward compatibility (existing commands unchanged)
- Keep cmd_ function pattern consistent with existing code
- Minimal changes to main() dispatch logic

## Acceptance Criteria (Gate - INTEGRATION)
- [ ] Wire test: All three commands integrate into main() command dispatcher
- [ ] CLI: `python3 swarm.py --help` shows all commands (kill, reset, status)
- [ ] Functional: `swarm.py kill <task_id>` removes task from pending list
- [ ] Functional: `swarm.py reset` clears state to clean slate
- [ ] Functional: `swarm.py status --verbose` shows detailed output
- [ ] Backward compatible: Existing commands (wave, tasks, results, collect) still work

## Notes
- RUNBOOK.md line 55-61 documents these as "Emergency Commands"
- These are CLI enhancements, no architectural changes
- Focus on simple, reliable implementations following existing patterns
- Test interactively to ensure state is updated correctly
